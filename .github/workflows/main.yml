# ğŸ›¸ OMNITRIX VPS SESSION - BEN 10 ALIEN FORCE EDITION ğŸ‘½
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#                    ğŸ”‹ POWERED BY ALIEN TECHNOLOGY ğŸ”‹
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# 
# ğŸŒŸ REQUIRED PLUMBER SECRETS:
# â”£â” ğŸ”— TAILSCALE_AUTHKEY: Plumber communication network key
# â”£â” â˜ï¸ RCLONE_CONFIG: Galvan Prime cloud storage configuration  
# â”£â” ğŸ” USER_PASSWORD: Hero access credentials
# â”—â” ğŸ—„ï¸ DB_ROOT_PASSWORD: Database vault master key (optional)
#
# ğŸ¯ ALIEN POWERS ACTIVATED:
# â”£â” ğŸ›¸ 6-hour persistent universe session
# â”£â” âš¡ Lightning-fast selective data backup/restore
# â”£â” ğŸ”„ Multi-dimensional fallback systems
# â”£â” ğŸŒ Galactic network integration (Tailscale VPN)
# â”£â” ğŸ›ï¸ Command center deployment (aaPanel)
# â”£â” ğŸ—„ï¸ Database fortress (MariaDB)
# â”£â” ğŸ‘¤ Hero account management
# â”—â” ğŸ›¡ï¸ Self-healing error recovery
#
# Ben Tennyson says: "It's Hero Time!" ğŸ’¥

name: "ğŸ›¸ OMNITRIX VPS - Ben 10 Alien Force Edition ğŸ‘½"

on:
  workflow_dispatch:
    inputs:
      alien_mode:
        description: 'ğŸ‘½ Select Alien Form'
        required: false
        default: 'humungousaur'
        type: choice
        options:
          - humungousaur  # Standard power mode
          - brainstorm    # Debug mode with extended analysis
          - jetray        # Speed mode (faster execution)
          - chromastone   # Shield mode (extra error handling)
      debug_session:
        description: 'ğŸ” Enable Brainstorm Debug Mode'
        required: false
        default: 'false'
        type: boolean
  schedule:
    # Every 6 hours - Ben's patrol schedule! ğŸŒŸ
    - cron: '0 */6 * * *'

env:
  # ğŸ›¸ Alien Technology Configuration
  BACKUP_NEXUS: /mnt/omnitrix/backups
  BACKUP_ARTIFACT: omnitrix-data-core.tar.gz
  GALVAN_CLOUD: mega:omnitrix-vault
  HERO_SESSION_DURATION: 19800  # 5.5 hours in seconds
  PLUMBER_NETWORK: Plumbers-HQ
  
jobs:
  omnitrix_session:
    name: "ğŸ›¸ OMNITRIX UNIVERSE SESSION ğŸ‘½"
    runs-on: ubuntu-22.04
    timeout-minutes: 350
    permissions:
      contents: read
      actions: write
    
    steps:
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    # ğŸŒŸ PHASE 1: OMNITRIX INITIALIZATION & ALIEN TECH DEPLOYMENT
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    - name: "ğŸ›¸ Scanning Universe Repository"
      uses: actions/checkout@v4
      
    - name: "âš¡ DEPLOYING ALIEN TECHNOLOGY SUITE"
      run: |
        set -euo pipefail
        
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        echo "ğŸ›¸            OMNITRIX SYSTEM ACTIVATION               ğŸ‘½"
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        echo "ğŸ”‹ Alien Form Selected: ${{ github.event.inputs.alien_mode || 'humungousaur' }}"
        echo "ğŸŒŸ Hero: Ben Tennyson | Session: Alien Force"
        echo "â° Mission Start: $(date)"
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        
        # Update galactic package registry
        echo "ğŸ›¸ Updating Galactic Package Registry..."
        sudo apt-get update -qq || {
          echo "âš ï¸ Primary registry failed, trying backup mirrors..."
          sleep 5
          sudo apt-get update -qq || echo "âš ï¸ Registry update incomplete, proceeding..."
        }
        
        # Install Plumber communication tools
        echo "ğŸ”— Installing Plumber Communication Suite..."
        curl -fsSL https://rclone.org/install.sh | sudo bash || {
          echo "âš ï¸ Rclone installation failed, trying alternative..."
          wget https://downloads.rclone.org/rclone-current-linux-amd64.zip
          unzip rclone-current-linux-amd64.zip
          sudo cp rclone-*/rclone /usr/bin/
          sudo chmod +x /usr/bin/rclone
        }
        
        # Deploy alien technology toolkit
        echo "ğŸ‘½ Deploying Alien Technology Toolkit..."
        ALIEN_TOOLS=(
          tar gzip unzip curl wget jq
          openssh-server htop nano vim git net-tools 
          software-properties-common apt-transport-https 
          ca-certificates gnupg lsb-release psmisc screen
          expect tmate mariadb-server mariadb-client
          build-essential python3-pip
        )
        
        for tool in "${ALIEN_TOOLS[@]}"; do
          if ! dpkg -l | grep -q "^ii  $tool "; then
            echo "ğŸ“¦ Installing $tool..."
            sudo DEBIAN_FRONTEND=noninteractive apt-get install -y $tool || {
              echo "âš ï¸ $tool installation failed, adding to retry list..."
            }
          fi
        done
        
        # Verify critical tools
        CRITICAL_TOOLS=("rclone" "jq" "curl" "tar")
        for tool in "${CRITICAL_TOOLS[@]}"; do
          if ! command -v $tool &> /dev/null; then
            echo "âŒ CRITICAL: $tool not available!"
            exit 1
          fi
        done
        
        echo "âœ… ALIEN TECHNOLOGY DEPLOYMENT COMPLETE! ğŸ›¸"

    - name: "â˜ï¸ GALVAN PRIME CLOUD CONFIGURATION"
      run: |
        set -euo pipefail
        echo "â˜ï¸ Establishing connection to Galvan Prime Cloud Storage..."
        
        # Validate Galvan configuration
        if [[ -z "${{ secrets.RCLONE_CONFIG || '' }}" ]]; then
          echo "âŒ CRITICAL ERROR: Galvan Prime access credentials missing!"
          echo "ğŸ›¸ The Omnitrix requires RCLONE_CONFIG for cloud connectivity!"
          exit 1
        fi
        
        # Create secure configuration directory
        sudo mkdir -p ~/.config/rclone
        sudo chmod 700 ~/.config/rclone
        
        # Deploy Galvan Prime credentials with fallback detection
        echo "ğŸ” Decoding Galvan Prime credentials..."
        if echo "${{ secrets.RCLONE_CONFIG }}" | sudo base64 -d &>/dev/null; then
          # Base64 encoded configuration
          echo "${{ secrets.RCLONE_CONFIG }}" | sudo base64 -d > ~/.config/rclone/rclone.conf
          echo "âœ… Base64 encoded credentials decoded successfully!"
        else
          # Plain text configuration  
          echo "${{ secrets.RCLONE_CONFIG }}" > ~/.config/rclone/rclone.conf
          echo "âœ… Plain text credentials configured successfully!"
        fi
        
        sudo chmod 600 ~/.config/rclone/rclone.conf
        
        # Test Galvan Prime connectivity
        echo "ğŸ§ª Testing Galvan Prime connectivity..."
        if rclone lsd mega: &>/dev/null; then
          echo "âœ… Galvan Prime cloud connection established! ğŸŒŒ"
        else
          echo "âš ï¸ Galvan Prime connectivity test failed, but proceeding..."
          echo "ğŸ’¡ Cloud features may be limited during this session"
        fi

    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    # ğŸŒŸ PHASE 2: TEMPORAL DATA CORE RECOVERY PROTOCOLS
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    - name: "ğŸ” SCANNING FOR TEMPORAL DATA CORES"
      id: data_core_scan
      run: |
        set -euo pipefail
        echo "ğŸ” Initiating temporal data core scan across dimensions..."
        
        RECOVERY_SUCCESS=false
        
        # Priority 1: Scan Galvan Prime vault for backup links
        echo "ğŸ›¸ Scanning Galvan Prime vault for data cores..."
        if rclone ls "${GALVAN_CLOUD}/temporal_backup_link.txt" &>/dev/null; then
            BACKUP_LINK=$(rclone cat "${GALVAN_CLOUD}/temporal_backup_link.txt" 2>/dev/null || echo "")
            if [[ -n "$BACKUP_LINK" ]]; then
              echo "âœ… TEMPORAL DATA CORE LINK FOUND IN GALVAN PRIME! ğŸŒŒ"
              echo "ğŸ”— Link: ${BACKUP_LINK:0:50}..."
              echo "has_backup=true" >> $GITHUB_OUTPUT
              echo "backup_source=galvan_prime" >> $GITHUB_OUTPUT  
              echo "artifact_url=${BACKUP_LINK}" >> $GITHUB_OUTPUT
              RECOVERY_SUCCESS=true
            fi
        fi
        
        # Priority 2: Scan recent GitHub artifacts if Galvan Prime fails
        if [[ "$RECOVERY_SUCCESS" == "false" ]]; then
          echo "ğŸ” Galvan Prime scan failed, scanning recent GitHub artifacts..."
          
          # Find workflow ID with retry logic
          for attempt in {1..3}; do
            WORKFLOW_ID=$(curl -s -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" \
              "https://api.github.com/repos/${{ github.repository }}/actions/workflows" \
              | jq -r '.workflows[] | select(.name | contains("OMNITRIX") or contains("Ben 10") or contains("Persistent")) | .id' \
              | head -1 2>/dev/null || echo "")
            
            if [[ -n "$WORKFLOW_ID" && "$WORKFLOW_ID" != "null" ]]; then
              break
            fi
            
            echo "âš ï¸ Workflow scan attempt $attempt failed, retrying..."
            sleep 5
          done
          
          if [[ -n "$WORKFLOW_ID" && "$WORKFLOW_ID" != "null" ]]; then
            echo "ğŸ” Found workflow ID: $WORKFLOW_ID"
            
            # Find recent successful runs
            RECENT_RUN=$(curl -s -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" \
              "https://api.github.com/repos/${{ github.repository }}/actions/workflows/${WORKFLOW_ID}/runs?status=success&per_page=5" \
              | jq -r '.workflow_runs[] | select(.id != ${{ github.run_id }}) | .id' \
              | head -1 2>/dev/null || echo "")
              
            if [[ -n "$RECENT_RUN" && "$RECENT_RUN" != "null" ]]; then
              echo "ğŸ” Scanning run: $RECENT_RUN"
              
              # Find backup artifact
              ARTIFACT_ID=$(curl -s -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" \
                "https://api.github.com/repos/${{ github.repository }}/actions/runs/${RECENT_RUN}/artifacts" \
                | jq -r --arg name "$BACKUP_ARTIFACT" '.artifacts[] | select(.name | contains($name) or contains("backup") or contains("omnitrix")) | .id' \
                | head -1 2>/dev/null || echo "")
                
              if [[ -n "$ARTIFACT_ID" && "$ARTIFACT_ID" != "null" ]]; then
                ARTIFACT_URL="https://api.github.com/repos/${{ github.repository }}/actions/artifacts/${ARTIFACT_ID}/zip"
                echo "âœ… TEMPORAL DATA CORE FOUND IN GITHUB DIMENSION! ğŸ“¦"
                echo "ğŸ†” Artifact ID: $ARTIFACT_ID"
                echo "has_backup=true" >> $GITHUB_OUTPUT
                echo "backup_source=github_artifact" >> $GITHUB_OUTPUT
                echo "artifact_url=${ARTIFACT_URL}" >> $GITHUB_OUTPUT
                RECOVERY_SUCCESS=true
              fi
            fi
          fi
        fi
        
        # Priority 3: Direct Galvan Prime backup scan
        if [[ "$RECOVERY_SUCCESS" == "false" ]]; then
          echo "ğŸ›¸ Performing direct Galvan Prime backup scan..."
          LATEST_BACKUP=$(rclone lsf "${GALVAN_CLOUD}/" | grep -E "(backup|omnitrix).*\.tar\.gz" | sort -r | head -1 2>/dev/null || echo "")
          
          if [[ -n "$LATEST_BACKUP" ]]; then
            echo "âœ… DIRECT GALVAN BACKUP FOUND! ğŸŒŒ"  
            echo "ğŸ“ File: $LATEST_BACKUP"
            echo "has_backup=true" >> $GITHUB_OUTPUT
            echo "backup_source=galvan_direct" >> $GITHUB_OUTPUT
            echo "backup_file=${LATEST_BACKUP}" >> $GITHUB_OUTPUT
            RECOVERY_SUCCESS=true
          fi
        fi
        
        # Final result
        if [[ "$RECOVERY_SUCCESS" == "false" ]]; then
          echo "â„¹ï¸ No temporal data cores found across all dimensions"
          echo "ğŸ›¸ Initiating fresh universe creation protocol..."
          echo "has_backup=false" >> $GITHUB_OUTPUT
          echo "backup_source=none" >> $GITHUB_OUTPUT
        else
          echo "âœ… TEMPORAL DATA CORE RECOVERY PROTOCOL SUCCESSFUL! ğŸ¯"
        fi

    - name: "ğŸ“¥ TEMPORAL DATA CORE RESTORATION"
      if: steps.data_core_scan.outputs.has_backup == 'true'
      run: |
        set -euo pipefail
        
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        echo "ğŸ“¥        TEMPORAL DATA CORE RESTORATION PROTOCOL        ğŸ‘½"
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        echo "ğŸ”‹ Source: ${{ steps.data_core_scan.outputs.backup_source }}"
        echo "âš¡ Initiating quantum data reconstruction..."
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        
        # Create secure restoration chamber
        RESTORE_CHAMBER="/mnt/omnitrix/restore"
        sudo mkdir -p "$RESTORE_CHAMBER"
        cd "$RESTORE_CHAMBER"
        
        # Execute restoration based on source
        case "${{ steps.data_core_scan.outputs.backup_source }}" in
          "galvan_prime"|"github_artifact")
            echo "ğŸŒŒ Downloading from ${{ steps.data_core_scan.outputs.backup_source }}..."
            
            # Download with retry mechanism
            for attempt in {1..3}; do
              if curl -L -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" \
                     "${{ steps.data_core_scan.outputs.artifact_url }}" \
                     -o "data_core.zip"; then
                echo "âœ… Download successful on attempt $attempt!"
                break
              else
                echo "âš ï¸ Download attempt $attempt failed, retrying..."
                sleep $((attempt * 5))
              fi
            done
            
            # Extract and verify
            echo "ğŸ“¦ Extracting temporal data core..."
            sudo unzip -q data_core.zip 2>/dev/null || unzip data_core.zip
            
            # Find the actual backup file
            BACKUP_FILE=$(find . -name "*.tar.gz" -type f | head -1)
            if [[ -z "$BACKUP_FILE" ]]; then
              echo "âŒ No backup file found in extracted data!"
              ls -la
              exit 1
            fi
            ;;
            
          "galvan_direct")
            echo "ğŸ›¸ Direct download from Galvan Prime..."
            BACKUP_FILE="${{ steps.data_core_scan.outputs.backup_file }}"
            
            for attempt in {1..3}; do
              if rclone copy "${GALVAN_CLOUD}/${BACKUP_FILE}" .; then
                echo "âœ… Direct download successful on attempt $attempt!"
                break
              else
                echo "âš ï¸ Direct download attempt $attempt failed, retrying..."
                sleep $((attempt * 5))
              fi
            done
            ;;
        esac
        
        # Validate data core integrity
        echo "ğŸ§ª Validating temporal data core integrity..."
        if [[ -f "$BACKUP_FILE" ]]; then
          CORE_SIZE=$(du -h "$BACKUP_FILE" | cut -f1)
          echo "ğŸ“‹ Data Core Size: $CORE_SIZE"
          
          if tar -tzf "$BACKUP_FILE" &>/dev/null; then
            echo "âœ… Data core integrity verified! ğŸ›¡ï¸"
          else
            echo "âŒ Data core corruption detected!"
            echo "ğŸ”„ Attempting repair protocols..."
            # Try to extract anyway - sometimes works
          fi
        else
          echo "âŒ Data core file not found!"
          exit 1
        fi
        
        echo "ğŸ”„ Initiating quantum data restoration sequence..."
        
        # Create restoration staging area
        STAGING_AREA="/tmp/omnitrix_restore"
        sudo mkdir -p "$STAGING_AREA"
        
        # Extract data core
        echo "ğŸ“‚ Extracting temporal data core..."
        tar -xzf "$BACKUP_FILE" -C "$STAGING_AREA" 2>/dev/null || {
          echo "âš ï¸ Standard extraction failed, trying alternative method..."
          tar -xf "$BACKUP_FILE" -C "$STAGING_AREA"
        }
        
        # Execute restoration protocols with error handling
        echo "ğŸ”§ Executing restoration protocols..."
        
        # Restore Hero Base (home directories)
        if [ -d "$STAGING_AREA/selective_backup/home" ]; then
          echo "ğŸ  Restoring Hero Base (home directories)..."
          sudo cp -rf "$STAGING_AREA/selective_backup/home"/* /home/ 2>/dev/null || {
            echo "âš ï¸ Some home files failed to restore, continuing..."
          }
        fi
        
        # Restore Command Center (root)
        if [ -d "$STAGING_AREA/selective_backup/root" ]; then
          echo "ğŸ‘‘ Restoring Command Center (root directory)..."
          sudo cp -rf "$STAGING_AREA/selective_backup/root/." /root/ 2>/dev/null || {
            echo "âš ï¸ Some root files failed to restore, continuing..."
          }
          sudo chown -R root:root /root 2>/dev/null || true
        fi
        
        # Restore Plumber Network State (Tailscale)
        if [ -d "$STAGING_AREA/selective_backup/tailscale" ]; then
          echo "ğŸ”— Restoring Plumber Network State..."
          sudo mkdir -p /var/lib/tailscale
          sudo cp -rf "$STAGING_AREA/selective_backup/tailscale"/* /var/lib/tailscale/ 2>/dev/null || {
            echo "âš ï¸ Tailscale state restoration failed, will reconnect fresh..."
          }
          sudo chown -R root:root /var/lib/tailscale 2>/dev/null || true
        fi
        
        # Restore Database Fortress (MariaDB)
        if [ -d "$STAGING_AREA/selective_backup/mysql" ]; then
          echo "ğŸ—„ï¸ Restoring Database Fortress..."
          sudo systemctl stop mariadb 2>/dev/null || true
          sleep 3
          sudo mkdir -p /var/lib/mysql
          sudo cp -rf "$STAGING_AREA/selective_backup/mysql"/* /var/lib/mysql/ 2>/dev/null || {
            echo "âš ï¸ Database restoration failed, will recreate fresh..."
          }
          sudo chown -R mysql:mysql /var/lib/mysql 2>/dev/null || true
          sudo systemctl start mariadb 2>/dev/null || true
        fi
        
        # Restore Web Arsenal (/var/www)
        if [ -d "$STAGING_AREA/selective_backup/www" ]; then
          echo "ğŸŒ Restoring Web Arsenal..."
          sudo mkdir -p /var/www
          sudo cp -rf "$STAGING_AREA/selective_backup/www"/* /var/www/ 2>/dev/null || {
            echo "âš ï¸ Some web files failed to restore, continuing..."
          }
          sudo chown -R www-data:www-data /var/www 2>/dev/null || true
        fi
        
        # Restore Control Panel (aaPanel)
        if [ -d "$STAGING_AREA/selective_backup/aapanel" ]; then
          echo "ğŸ›ï¸ Restoring Alien Control Panel..."
          sudo mkdir -p /www
          sudo cp -rf "$STAGING_AREA/selective_backup/aapanel"/* /www/ 2>/dev/null || {
            echo "âš ï¸ Some control panel files failed to restore, continuing..."
          }
          sudo chown -R root:root /www 2>/dev/null || true
        fi
        
        # Restore System Configurations
        if [ -d "$STAGING_AREA/selective_backup/etc_configs" ]; then
          echo "âš™ï¸ Restoring System Configurations..."
          sudo cp -rf "$STAGING_AREA/selective_backup/etc_configs"/* /etc/ 2>/dev/null || {
            echo "âš ï¸ Some config files failed to restore, continuing..."
          }
        fi
        
        # Restore Alien Applications (/opt)
        if [ -d "$STAGING_AREA/selective_backup/opt" ]; then
          echo "ğŸ‘½ Restoring Alien Applications..."
          sudo mkdir -p /opt
          sudo cp -rf "$STAGING_AREA/selective_backup/opt"/* /opt/ 2>/dev/null || {
            echo "âš ï¸ Some applications failed to restore, continuing..."
          }
        fi
        
        # Cleanup restoration chamber
        sudo rm -rf "$STAGING_AREA" "$RESTORE_CHAMBER"
        
        echo "âœ… TEMPORAL DATA CORE RESTORATION COMPLETE! ğŸ‰"
        echo "ğŸ›¸ Previous universe state successfully reconstructed!"

    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    # ğŸŒŸ PHASE 3: UNIVERSE CONFIGURATION & ALIEN DEPLOYMENT
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    - name: "ğŸ‘¤ HERO ACCOUNT CONFIGURATION"
      run: |
        set -euo pipefail
        
        echo "ğŸ‘¤ Configuring Hero Account - Ben Tennyson Access Protocol..."
        
        # Validate hero credentials
        if [[ -z "${{ secrets.USER_PASSWORD || '' }}" ]]; then
          echo "âŒ CRITICAL: Hero access credentials missing!"
          echo "ğŸ›¸ The Omnitrix requires USER_PASSWORD for hero authentication!"
          exit 1
        fi
        
        # Create hero account with fallback handling
        echo "ğŸ” Creating hero account: jacky..."
        if ! id jacky &>/dev/null; then
          sudo useradd -m -s /bin/bash jacky || {
            echo "âš ï¸ Standard user creation failed, trying alternative..."
            sudo adduser --disabled-password --gecos "" jacky
          }
          echo "âœ… Hero account created successfully!"
        else
          echo "âœ… Hero account already exists!"
        fi
        
        # Set hero credentials
        echo "ğŸ”‘ Configuring hero authentication..."
        echo "Jacky:${{ secrets.USER_PASSWORD }}" | sudo chpasswd || {
          echo "âŒ Password configuration failed!"
          exit 1
        }
        
        # Grant hero powers (sudo access)
        echo "âš¡ Granting hero powers..."
        sudo usermod -aG sudo jacky 2>/dev/null || {
          sudo usermod -aG admin jacky 2>/dev/null || {
            echo "âš ï¸ Sudo group assignment failed, creating manual entry..."
          }
        }
        
        # Create heroes sudoers file
        echo "jacky ALL=(ALL:ALL) NOPASSWD:ALL" | sudo tee /etc/sudoers.d/hero > /dev/null
        sudo chmod 440 /etc/sudoers.d/hero
        
        # Configure Docker access if available
        if getent group docker &>/dev/null; then
          sudo usermod -aG docker jacky 2>/dev/null || true
        fi
        
        # Set universe identifier
        echo "ğŸŒ Setting universe identifier..."
        sudo hostnamectl set-hostname "$PLUMBER_NETWORK" 2>/dev/null || {
          echo "$PLUMBER_NETWORK" | sudo tee /etc/hostname > /dev/null
        }
        echo "127.0.1.1 $PLUMBER_NETWORK" | sudo tee -a /etc/hosts > /dev/null
        
        echo "âœ… Hero account configuration complete! ğŸ¦¸â€â™‚ï¸"
        echo "ğŸ¯ Hero: jacky | Powers: sudo, docker | Universe: $PLUMBER_NETWORK"

    - name: "ğŸ›ï¸ ALIEN CONTROL PANEL DEPLOYMENT"
      run: |
        set -euo pipefail
        
        echo "ğŸ›ï¸ Deploying Alien Control Panel (aaPanel) - Galvan Tech Integration..."
        
        # Check if control panel already exists
        if command -v bt &>/dev/null && [ -d /www/server ]; then
          echo "âœ… Alien Control Panel already deployed (restored from backup)!"
          PANEL_EXISTS=true
        else
          echo "ğŸš€ Initiating fresh control panel deployment..."
          PANEL_EXISTS=false
        fi
        
        if [[ "$PANEL_EXISTS" == "false" ]]; then
          # Download latest Galvan installer
          echo "ğŸ“¥ Downloading Galvan installer..."
          INSTALLER_URLS=(
            "http://www.aapanel.com/script/install_6.0_en.sh"
            "http://download.bt.cn/install/install_6.0_en.sh"
            "https://raw.githubusercontent.com/aaPanel/aaPanel/main/install/install_6.0_en.sh"
          )
          
          INSTALLER_SUCCESS=false
          for url in "${INSTALLER_URLS[@]}"; do
            if curl -fsSL -o /tmp/aapanel_install.sh "$url"; then
              echo "âœ… Installer downloaded from: $url"
              INSTALLER_SUCCESS=true
              break
            else
              echo "âš ï¸ Failed to download from: $url"
            fi
          done
          
          if [[ "$INSTALLER_SUCCESS" == "false" ]]; then
            echo "âŒ All installer URLs failed!"
            echo "ğŸ’¡ Control panel will be available for manual installation"
          else
            chmod +x /tmp/aapanel_install.sh
            
            # Create automated installation script
            echo "ğŸ¤– Creating automated installation protocol..."
            cat > /tmp/auto_install_aapanel.exp << 'EOF'
            #!/usr/bin/expect -f
            set timeout 600
            spawn bash /tmp/aapanel_install.sh
            expect {
            "*Do you want to install*" { send "y\r"; exp_continue }
            "*install now*" { send "y\r"; exp_continue }
            "*force install*" { send "yes\r"; exp_continue }
             "*confirm*" { send "y\r"; exp_continue }
                eof
              }
          EOF
            chmod +x /tmp/auto_install_aapanel.exp
            
            # Execute installation with timeout protection
            echo "âš¡ Executing Galvan installation protocol..."
            timeout 900 /tmp/auto_install_aapanel.exp || {
              echo "âš ï¸ Automated installation timeout, trying alternative method..."
              timeout 600 bash -c "printf 'y\ny\nyes\ny\n' | sudo bash /tmp/aapanel_install.sh" || {
                echo "âš ï¸ Alternative installation failed, control panel may need manual setup"
              }
            }
          fi
        fi
        
        # Configure control panel credentials
        echo "ğŸ”§ Configuring control panel access credentials..."
        sleep 10  # Allow full initialization
        
        # Multiple credential setting attempts
        CRED_SUCCESS=false
        
        # Method 1: bt command
        if command -v bt &>/dev/null; then
          echo "ğŸ¯ Using bt command for credential configuration..."
          if echo "Ben10" | sudo bt 6 2>/dev/null && echo "omnitrix" | sudo bt 5 2>/dev/null; then
            CRED_SUCCESS=true
            echo "âœ… Credentials set via bt command!"
          fi
        fi
        
        # Method 2: Direct Python tools
        if [[ "$CRED_SUCCESS" == "false" ]] && [ -f /www/server/panel/tools.py ]; then
          echo "ğŸ Using Python tools for credential configuration..."
          cd /www/server/panel
          if sudo python3 tools.py username Ben10 2>/dev/null && sudo python3 tools.py password omnitrix 2>/dev/null; then
            CRED_SUCCESS=true
            echo "âœ… Credentials set via Python tools!"
          fi
        fi
        
        # Method 3: PyEnv method
        if [[ "$CRED_SUCCESS" == "false" ]] && [ -f /www/server/panel/pyenv/bin/python ]; then
          echo "ğŸ”¬ Using PyEnv for credential configuration..."
          if sudo /www/server/panel/pyenv/bin/python /www/server/panel/tools.py username Ben10 2>/dev/null && \
             sudo /www/server/panel/pyenv/bin/python /www/server/panel/tools.py password omnitrix 2>/dev/null; then
            CRED_SUCCESS=true
            echo "âœ… Credentials set via PyEnv!"
          fi
        fi
        
        if [[ "$CRED_SUCCESS" == "true" ]]; then
          echo "ğŸ‰ ALIEN CONTROL PANEL DEPLOYED SUCCESSFULLY! ğŸ›ï¸"
          echo "ğŸ” Access: Username=Ben10, Password=omnitrix"
        else
          echo "âš ï¸ Credential configuration incomplete - manual setup may be required"
          echo "ğŸ’¡ Default access will be available via web interface"
        fi

    - name: "ğŸ—„ï¸ DATABASE FORTRESS INITIALIZATION"  
      run: |
        set -euo pipefail
        
        echo "ğŸ—„ï¸ Initializing Database Fortress (MariaDB) - Plumber Archive System..."
        
        # Enable and start database service
        echo "âš¡ Powering up database fortress..."
        sudo systemctl enable mariadb || echo "âš ï¸ MariaDB enable failed"
        sudo systemctl start mariadb || {
          echo "âš ï¸ MariaDB start failed, attempting repair..."
          sudo mysql_install_db --user=mysql --basedir=/usr --datadir=/var/lib/mysql
          sudo systemctl start mariadb || echo "âš ï¸ MariaDB requires manual intervention"
        }
        
        # Verify database service
        sleep 5
        if sudo systemctl is-active mariadb &>/dev/null; then
          echo "âœ… Database fortress online! ğŸ°"
        else
          echo "âš ï¸ Database fortress may need manual activation"
        fi
        
        # Configure database security
        echo "ğŸ›¡ï¸ Configuring database fortress security..."
        
        # Set root password if provided
        if [[ -n "${{ secrets.DB_ROOT_PASSWORD || '' }}" ]]; then
          echo "ğŸ” Setting master vault password..."
          
          # Try multiple methods for setting root password
          sudo mysql -e "ALTER USER 'root'@'localhost' IDENTIFIED BY '${{ secrets.DB_ROOT_PASSWORD }}';" 2>/dev/null || \
          sudo mysqladmin -u root password '${{ secrets.DB_ROOT_PASSWORD }}' 2>/dev/null || \
          echo "âš ï¸ Root password configuration failed - using default security"
          
          # Create hero database
          sudo mysql -u root -p"${{ secrets.DB_ROOT_PASSWORD }}" -e "CREATE DATABASE IF NOT EXISTS omnitrix_data;" 2>/dev/null || \
          sudo mysql -u root -p"${{ secrets.DB_ROOT_PASSWORD }}" -e "CREATE DATABASE IF NOT EXISTS test;" 2>/dev/null || \
          echo "âš ï¸ Hero database creation failed"
        else
          echo "ğŸ”“ Using default database security..."
          # Create databases with default access
          sudo mysql -e "CREATE DATABASE IF NOT EXISTS omnitrix_data;" 2>/dev/null || \
          sudo mysql -e "CREATE DATABASE IF NOT EXISTS test;" 2>/dev/null || \
          echo "âš ï¸ Database creation failed"
        fi
        
        echo "âœ… Database fortress initialization complete! ğŸ—„ï¸"

    - name: "âš¡ ALIEN POWER SYSTEMS ACTIVATION"
      run: |
        set -euo pipefail
        
        echo "âš¡ Activating all alien power systems across the universe..."
        
        # Reload system configurations
        echo "ğŸ”„ Reloading system configurations..."
        sudo systemctl daemon-reload
        
        # Essential power systems
        POWER_SYSTEMS=("ssh" "mariadb")
        
        echo "ğŸŒŸ Activating essential power systems..."
        for system in "${POWER_SYSTEMS[@]}"; do
          echo "âš¡ Powering up $system..."
          
          # Enable with fallback
          sudo systemctl enable "$system" 2>/dev/null || {
            echo "âš ï¸ $system enable failed, trying alternative..."
            sudo systemctl enable "$system.service" 2>/dev/null || true
          }
          
          # Start with fallback  
          sudo systemctl start "$system" 2>/dev/null || {
            echo "âš ï¸ $system start failed, attempting restart..."
            sudo systemctl restart "$system" 2>/dev/null || {
              echo "âš ï¸ $system requires manual intervention"
            }
          }
        done
        
        # Optional power systems
        OPTIONAL_SYSTEMS=("docker" "nginx" "apache2")
        
        echo "ğŸ”‹ Activating optional power systems..."
        for system in "${OPTIONAL_SYSTEMS[@]}"; do
          if systemctl list-units --all | grep -q "$system"; then
            echo "âš¡ Found $system, activating..."
            sudo systemctl enable --now "$system" 2>/dev/null || {
              echo "âš ï¸ $system activation failed, but continuing..."
            }
          fi
        done
        
        # Activate Alien Control Panel
        if command -v bt &>/dev/null; then
          echo "ğŸ›ï¸ Activating Alien Control Panel..."
          sudo bt start 2>/dev/null || {
            sudo systemctl start bt 2>/dev/null || {
              sudo /etc/init.d/bt start 2>/dev/null || {
                echo "âš ï¸ Control panel activation may require manual intervention"
              }
            }
          }
          sleep 3
        fi
        
        # Power system diagnostics
        echo "ğŸ” Running power system diagnostics..."
        sleep 5
        
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        echo "ğŸ”‹            POWER SYSTEM STATUS REPORT              âš¡"
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        
        for system in ssh mariadb docker nginx apache2 bt; do
          if systemctl is-active "$system" &>/dev/null; then
            echo "  âœ… $system - ONLINE AND OPERATIONAL"
          else
            echo "  âš ï¸ $system - OFFLINE OR UNAVAILABLE"
          fi
        done
        
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        echo "âœ… ALIEN POWER SYSTEMS ACTIVATION COMPLETE! âš¡"

    - name: "ğŸ”— PLUMBER NETWORK INTEGRATION"
      run: |
        set -euo pipefail
        
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        echo "ğŸ”—        PLUMBER NETWORK INTEGRATION PROTOCOL         ğŸŒŒ" 
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        
        # Validate Plumber credentials
        if [[ -z "${{ secrets.TAILSCALE_AUTHKEY || '' }}" ]]; then
          echo "âŒ CRITICAL: Plumber network authentication key missing!"
          echo "ğŸ›¸ The Omnitrix requires TAILSCALE_AUTHKEY for network integration!"
          exit 1
        fi
        
        # Install Plumber network client
        echo "ğŸ“¡ Installing Plumber network client (Tailscale)..."
        
        TAILSCALE_SUCCESS=false
        # Method 1: Official installer
        if curl -fsSL https://tailscale.com/install.sh | sh; then
          TAILSCALE_SUCCESS=true
          echo "âœ… Plumber client installed via official installer!"
        else
          echo "âš ï¸ Official installer failed, trying package manager..."
          
          # Method 2: Package manager
          curl -fsSL https://pkgs.tailscale.com/stable/ubuntu/jammy.noarmor.gpg | sudo tee /usr/share/keyrings/tailscale-archive-keyring.gpg >/dev/null
          curl -fsSL https://pkgs.tailscale.com/stable/ubuntu/jammy.tailscale-keyring.list | sudo tee /etc/apt/sources.list.d/tailscale.list
          
          if sudo apt-get update && sudo apt-get install -y tailscale; then
            TAILSCALE_SUCCESS=true
            echo "âœ… Plumber client installed via package manager!"
          fi
        fi
        
        if [[ "$TAILSCALE_SUCCESS" == "false" ]]; then
          echo "âŒ All Plumber network installation methods failed!"
          echo "ğŸ›¸ Network integration will be unavailable this session"
          exit 1
        fi
        
        # Activate Plumber network service
        echo "âš¡ Activating Plumber network service..."
        sudo systemctl enable --now tailscaled || {
          echo "âš ï¸ Service activation failed, attempting manual start..."
          sudo tailscaled --state=/var/lib/tailscale/tailscaled.state --socket=/run/tailscale/tailscaled.sock &
          sleep 3
        }
        
        # Establish network connection
        echo "ğŸŒŒ Establishing connection to Plumber headquarters..."
        
        CONNECTION_SUCCESS=false
        for attempt in {1..3}; do
          echo "ğŸ”— Connection attempt $attempt/3..."
          
          if sudo tailscale up --authkey="${{ secrets.TAILSCALE_AUTHKEY }}" \
                             --hostname="$PLUMBER_NETWORK" \
                             --reset \
                             --accept-routes \
                             --timeout=60s; then
            CONNECTION_SUCCESS=true
            echo "âœ… Plumber network connection established!"
            break
          else
            echo "âš ï¸ Connection attempt $attempt failed, retrying..."
            sleep 10
          fi
        done
        
        if [[ "$CONNECTION_SUCCESS" == "false" ]]; then
          echo "âŒ All connection attempts failed!"
          echo "ğŸ›¸ Continuing without network integration..."
        fi
        
        # Deploy emergency communication system
        echo "ğŸ“¡ Deploying emergency communication system (tmate)..."
        if command -v tmate &>/dev/null; then
          tmate -S /tmp/emergency_comms.sock new-session -d 2>/dev/null || true
          tmate -S /tmp/emergency_comms.sock wait tmate-ready 2>/dev/null || true
        fi
        
        # Network status report
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        echo "ğŸŒŒ           PLUMBER NETWORK STATUS REPORT             ğŸ”—"
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        
        if [[ "$CONNECTION_SUCCESS" == "true" ]]; then
          PLUMBER_IP=$(sudo tailscale ip -4 2>/dev/null || echo "Acquiring...")
          echo "ğŸŒ Plumber Network IP: $PLUMBER_IP"
          echo "ğŸ¢ Network Status: CONNECTED TO HEADQUARTERS"
          
          # Show network devices
          echo "ğŸ‘¥ Connected Plumber Devices:"
          sudo tailscale status 2>/dev/null | head -5 || echo "   Getting device list..."
        else
          echo "ğŸŒ Plumber Network: OFFLINE"
          echo "ğŸ“¡ Emergency Systems: STANDBY"
        fi
        
        # Emergency access information
        if command -v tmate &>/dev/null; then
          EMERGENCY_SSH=$(tmate -S /tmp/emergency_comms.sock display -p '#{tmate_ssh}' 2>/dev/null || echo "Initializing...")
          echo "ğŸš¨ Emergency SSH: $EMERGENCY_SSH"
        fi
        
        echo "ğŸ” Hero SSH Access: ssh jacky@$PLUMBER_IP"
        echo "ğŸ—ï¸ Hero Password: [CONFIGURED]"
        
        if command -v bt &>/dev/null; then
          echo ""
          echo "ğŸ›ï¸ Alien Control Panel Access:"
          sudo bt default 2>/dev/null || {
            echo "   ğŸ“ URL: http://$PLUMBER_IP:7800"  
            echo "   ğŸ‘¤ Username: Ben10"
            echo "   ğŸ”‘ Password: omnitrix"
          }
        fi
        
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        echo "âœ… PLUMBER NETWORK INTEGRATION COMPLETE! ğŸŒŒ"

    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    # ğŸŒŸ PHASE 4: ALIEN FORCE OPERATIONAL MODE
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    - name: "ğŸ‘½ BRAINSTORM DEBUG SESSION"
      if: github.event.inputs.debug_session == 'true' || github.event.inputs.alien_mode == 'brainstorm'
      run: |
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        echo "ğŸ§         BRAINSTORM DEBUG SESSION ACTIVATED           ğŸ‘½"
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        echo "âš¡ Galvan intellect engaged for system analysis!"
        echo "ğŸ” Extended debugging session: 15 minutes"
        echo "ğŸ’¡ Use emergency SSH for direct system access"
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        
        # Enhanced system analysis
        echo "ğŸ”¬ Running comprehensive system analysis..."
        
        echo "ğŸ“Š System Resources:"
        df -h | head -10
        free -h
        
        echo "ğŸ“¡ Network Configuration:"
        ip addr show | grep -E "inet |UP"
        
        echo "ğŸ” Active Services:"
        systemctl list-units --state=active --type=service | head -10
        
        echo "ğŸ³ Docker Status:"
        docker version 2>/dev/null || echo "Docker not available"
        
        echo "â° Debug session active for 15 minutes..."
        echo "ğŸ§  Brainstorm says: Use this time wisely, Ben!"
        
        sleep 900  # 15 minutes
        
        echo "âœ… Brainstorm debug session complete! ğŸ§ "

    - name: "ğŸ›¸ OMNITRIX OPERATIONAL SESSION"
      run: |
        set -euo pipefail
        
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        echo "ğŸ›¸           OMNITRIX OPERATIONAL SESSION              ğŸ‘½"  
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        echo "âš¡ Alien Form: ${{ github.event.inputs.alien_mode || 'humungousaur' }}"
        echo "â° Session Duration: $((HERO_SESSION_DURATION / 3600)) hours $((HERO_SESSION_DURATION % 3600 / 60)) minutes"
        echo "ğŸ• Mission Start: $(date)"
        echo "ğŸ›¡ï¸ Hero on patrol! Universe protection active!"
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        
        # Initialize session variables
        MISSION_START=$(date +%s)
        LAST_STATUS_UPDATE=0
        BACKUP_INTERVAL=$((30 * 60))  # 30 minutes
        LAST_BACKUP=0
        STATUS_INTERVAL=$((10 * 60))  # 10 minutes
        
        # Operational mode selection
        case "${{ github.event.inputs.alien_mode || 'humungousaur' }}" in
          "humungousaur")
            echo "ğŸ¦• HUMUNGOUSAUR MODE: Maximum power and durability!"
            CHECK_INTERVAL=60  # 1 minute checks
            ;;
          "brainstorm")
            echo "ğŸ§  BRAINSTORM MODE: Enhanced monitoring and analysis!"
            CHECK_INTERVAL=30  # 30 second checks
            ;;
          "jetray")
            echo "âš¡ JETRAY MODE: High-speed operations!"
            CHECK_INTERVAL=15  # 15 second checks
            STATUS_INTERVAL=$((5 * 60))  # 5 minute status
            ;;
          "chromastone")
            echo "ğŸ’ CHROMASTONE MODE: Maximum protection and error handling!"
            CHECK_INTERVAL=45  # 45 second checks
            ;;
          *)
            echo "ğŸ›¸ DEFAULT MODE: Standard alien operations!"
            CHECK_INTERVAL=60
            ;;
        esac
        
        # Main operational loop
        while true; do
          CURRENT_TIME=$(date +%s)
          ELAPSED=$((CURRENT_TIME - MISSION_START))
          
          # Check for mission completion
          if [ $ELAPSED -gt $HERO_SESSION_DURATION ]; then
            echo "â° Mission duration completed! Time for universe backup..."
            break
          fi
          
          # Check for emergency shutdown signal
          if [ -f /tmp/stop ] || [ -f /tmp/emergency_shutdown ]; then
            echo "ğŸš¨ EMERGENCY SHUTDOWN SIGNAL DETECTED!"
            echo "ğŸ›¡ï¸ Initiating emergency protocols..."
            rm -f /tmp/stop /tmp/emergency_shutdown 2>/dev/null || true
            break
          fi
          
          # Periodic system backup
          if [ $((CURRENT_TIME - LAST_BACKUP)) -gt $BACKUP_INTERVAL ]; then
            echo "ğŸ’¾ Initiating periodic universe backup..."
            
            # Quick backup of critical data
            QUICK_BACKUP_DIR="/tmp/omnitrix_quick_backup"
            sudo mkdir -p "$QUICK_BACKUP_DIR"
            
            # Backup critical alien data
            echo "âš¡ Backing up critical alien technology..."
            sudo cp -r /var/lib/tailscale "$QUICK_BACKUP_DIR/" 2>/dev/null || true
            sudo cp -r /home/jacky "$QUICK_BACKUP_DIR/" 2>/dev/null || true
            
            # Create quick backup archive
            TIMESTAMP=$(date +%Y%m%d-%H%M%S)
            sudo tar -czf "/tmp/omnitrix-quick-$TIMESTAMP.tar.gz" -C /tmp omnitrix_quick_backup 2>/dev/null || true
            
            # Upload to Galvan Prime if possible
            rclone copy "/tmp/omnitrix-quick-$TIMESTAMP.tar.gz" "${GALVAN_CLOUD}/" 2>/dev/null || {
              echo "âš ï¸ Galvan Prime upload failed, backup stored locally"
            }
            
            # Cleanup
            sudo rm -rf "$QUICK_BACKUP_DIR" "/tmp/omnitrix-quick-$TIMESTAMP.tar.gz"
            
            LAST_BACKUP=$CURRENT_TIME
            echo "âœ… Periodic backup complete!"
          fi
          
          # Status update
          if [ $((CURRENT_TIME - LAST_STATUS_UPDATE)) -gt $STATUS_INTERVAL ]; then
            REMAINING=$((HERO_SESSION_DURATION - ELAPSED))
            HOURS=$((REMAINING / 3600))
            MINUTES=$(((REMAINING % 3600) / 60))
            
            echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
            echo "ğŸ›¸ OMNITRIX STATUS REPORT - $(date)"
            echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
            echo "â° Time Remaining: ${HOURS}h ${MINUTES}m"
            echo "ğŸ‘½ Alien Mode: ${{ github.event.inputs.alien_mode || 'humungousaur' }}"
            echo "ğŸŒ Universe: $PLUMBER_NETWORK"
            
            # System health check
            echo "ğŸ” System Health:"
            echo "  ğŸ”— Network: $(sudo tailscale status --json 2>/dev/null | jq -r '.BackendState' 2>/dev/null || echo 'Unknown')"
            echo "  ğŸ—„ï¸ Database: $(systemctl is-active mariadb 2>/dev/null || echo 'Unknown')" 
            echo "  ğŸ›ï¸ Control Panel: $(systemctl is-active bt 2>/dev/null || command -v bt &>/dev/null && echo 'Active' || echo 'Unknown')"
            echo "  ğŸ’¾ Disk Usage: $(df -h / | awk 'NR==2 {print $5}')"
            echo "  ğŸ§  Memory: $(free | awk 'NR==2{printf "%.1f%%", $3*100/$2}')"
            
            echo "ğŸ›¡ï¸ Hero Patrol: ACTIVE"
            echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
            
            LAST_STATUS_UPDATE=$CURRENT_TIME
          fi
          
          # Alien-specific monitoring
          case "${{ github.event.inputs.alien_mode || 'humungousaur' }}" in
            "brainstorm")
              # Enhanced monitoring for Brainstorm mode
              if [ $((ELAPSED % 300)) -eq 0 ]; then  # Every 5 minutes
                echo "ğŸ§  Brainstorm Analysis: Monitoring $(($(ps aux | wc -l) - 1)) processes, $(ss -tuln | wc -l) network connections"
              fi
              ;;
            "chromastone")
              # Error detection for Chromastone mode
              if journalctl --since="1 minute ago" --priority=err --quiet --no-pager | grep -q .; then
                echo "ğŸ’ Chromastone Shield: Error patterns detected, increasing monitoring"
              fi
              ;;
          esac
          
          # Sleep based on alien mode
          sleep $CHECK_INTERVAL
        done
        
        echo "ğŸ¬ OMNITRIX OPERATIONAL SESSION COMPLETE!"
        echo "ğŸ›¸ Preparing for universe preservation protocols..."

    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  
    # ğŸŒŸ PHASE 5: UNIVERSE PRESERVATION & TEMPORAL BACKUP PROTOCOLS
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    - name: "ğŸ’¾ UNIVERSE PRESERVATION PROTOCOL"
      if: always()
      run: |
        set -euo pipefail
        
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        echo "ğŸ’¾      UNIVERSE PRESERVATION PROTOCOL INITIATED       ğŸŒŒ"
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        echo "ğŸ›¸ Creating temporal data core for universe continuity..."
        echo "âš¡ Initiating selective alien technology backup..."
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        
        # Create preservation chamber
        sudo mkdir -p "$BACKUP_NEXUS"
        
        # Graceful service shutdown for consistent backup
        echo "ğŸ›‘ Initiating graceful alien system shutdown..."
        
        SERVICES_TO_STOP=("bt" "mariadb" "nginx" "apache2")
        for service in "${SERVICES_TO_STOP[@]}"; do
          if systemctl is-active "$service" &>/dev/null; then
            echo "âš¡ Gracefully shutting down $service..."
            sudo systemctl stop "$service" 2>/dev/null || {
              echo "âš ï¸ $service shutdown failed, force stopping..."
              sudo pkill -f "$service" 2>/dev/null || true
            }
          fi
        done
        
        # Wait for clean shutdown
        sleep 10
        
        # Create preservation staging area
        PRESERVATION_CHAMBER="/tmp/universe_preservation"
        sudo mkdir -p "$PRESERVATION_CHAMBER"
        
        echo "ğŸ“¦ Collecting alien technology and hero data..."
        
        # Hero Base Data (home directories)
        echo "ğŸ  Preserving Hero Base data..."
        if [ -d /home ] && [ "$(sudo ls -A /home 2>/dev/null)" ]; then
          sudo mkdir -p "$PRESERVATION_CHAMBER/home"
          sudo cp -rf /home/* "$PRESERVATION_CHAMBER/home/" 2>/dev/null || {
            echo "âš ï¸ Some hero base files failed to preserve"
          }
        fi
        
        # Command Center (root directory)  
        echo "ğŸ‘‘ Preserving Command Center..."
        if [ -d /root ] && [ "$(sudo ls -A /root 2>/dev/null)" ]; then
          sudo mkdir -p "$PRESERVATION_CHAMBER/root"
          sudo cp -rf /root/. "$PRESERVATION_CHAMBER/root/" 2>/dev/null || {
            echo "âš ï¸ Some command center files failed to preserve"
          }
        fi
        
        # Plumber Network State (Tailscale)
        echo "ğŸ”— Preserving Plumber Network quantum state..."
        if [ -d /var/lib/tailscale ] && [ "$(sudo ls -A /var/lib/tailscale 2>/dev/null)" ]; then
          sudo mkdir -p "$PRESERVATION_CHAMBER/tailscale"
          sudo cp -rf /var/lib/tailscale/* "$PRESERVATION_CHAMBER/tailscale/" 2>/dev/null || {
            echo "âš ï¸ Plumber network state preservation incomplete"
          }
        fi
        
        # Database Fortress (MariaDB)
        echo "ğŸ—„ï¸ Preserving Database Fortress..."
        if [ -d /var/lib/mysql ] && [ "$(sudo ls -A /var/lib/mysql 2>/dev/null)" ]; then
          sudo mkdir -p "$PRESERVATION_CHAMBER/mysql"
          sudo cp -rf /var/lib/mysql/* "$PRESERVATION_CHAMBER/mysql/" 2>/dev/null || {
            echo "âš ï¸ Database fortress preservation incomplete"
          }
        fi
        
        # Web Arsenal (/var/www)
        echo "ğŸŒ Preserving Web Arsenal..."
        if [ -d /var/www ] && [ "$(sudo ls -A /var/www 2>/dev/null)" ]; then
          sudo mkdir -p "$PRESERVATION_CHAMBER/www"
          sudo cp -rf /var/www/* "$PRESERVATION_CHAMBER/www/" 2>/dev/null || {
            echo "âš ï¸ Web arsenal preservation incomplete"
          }
        fi
        
        # Alien Control Panel (aaPanel)
        echo "ğŸ›ï¸ Preserving Alien Control Panel..."
        if [ -d /www ] && [ "$(sudo ls -A /www 2>/dev/null)" ]; then
          sudo mkdir -p "$PRESERVATION_CHAMBER/aapanel"
          sudo cp -rf /www/* "$PRESERVATION_CHAMBER/aapanel/" 2>/dev/null || {
            echo "âš ï¸ Control panel preservation incomplete"
          }
        fi
        
        # System Configuration Matrix
        echo "âš™ï¸ Preserving System Configuration Matrix..."
        sudo mkdir -p "$PRESERVATION_CHAMBER/etc_configs"
        
        # Critical configuration preservation
        CRITICAL_CONFIGS=(
          "hostname" "hosts" "ssh" "nginx" "apache2" 
          "mysql" "sudoers.d" "crontab" "systemd/system"
          "network" "resolv.conf"
        )
        
        for config in "${CRITICAL_CONFIGS[@]}"; do
          if [ -e "/etc/$config" ]; then
            echo "ğŸ“„ Preserving /etc/$config..."
            sudo cp -rf "/etc/$config" "$PRESERVATION_CHAMBER/etc_configs/" 2>/dev/null || true
          fi
        done
        
        # Alien Applications (/opt)
        echo "ğŸ‘½ Preserving Alien Applications..."
        if [ -d /opt ] && [ "$(sudo ls -A /opt 2>/dev/null)" ]; then
          sudo mkdir -p "$PRESERVATION_CHAMBER/opt"
          sudo cp -rf /opt/* "$PRESERVATION_CHAMBER/opt/" 2>/dev/null || {
            echo "âš ï¸ Alien applications preservation incomplete"
          }
        fi
        
        # Create universe manifest
        echo "ğŸ“‹ Creating Universe Preservation Manifest..."
        cat > "$PRESERVATION_CHAMBER/universe-manifest.txt" << EOF
        ğŸ›¸ OMNITRIX UNIVERSE PRESERVATION CORE
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        ğŸŒŸ Hero: Ben Tennyson | Session: Alien Force Edition
        â° Preservation Date: $(date)
        ğŸ†” Session ID: ${{ github.run_id }}
        ğŸŒ Universe: $PLUMBER_NETWORK
        ğŸ‘½ Alien Mode: ${{ github.event.inputs.alien_mode || 'humungousaur' }}

        ğŸ“¦ PRESERVED ALIEN TECHNOLOGY:
        âœ… Hero Base (/home) - Personal data and configurations
        âœ… Command Center (/root) - Root user environment
        âœ… Plumber Network State (/var/lib/tailscale) - VPN quantum state
        âœ… Database Fortress (/var/lib/mysql) - MariaDB alien databases  
        âœ… Web Arsenal (/var/www) - Web server alien technology
        âœ… Control Panel (/www) - aaPanel alien command interface
        âœ… Configuration Matrix (/etc) - Critical system configurations
        âœ… Alien Applications (/opt) - Custom installed alien tech

        ğŸš« EXCLUDED FOR EFFICIENCY:
        âŒ Docker Container Overlay (pre-installed technology)
        âŒ System Packages (available in base universe)
        âŒ Temporary Files (ephemeral data)
        âŒ Virtual Filesystems (auto-generated)
        âŒ Cache Files (reconstructible data)

        ğŸ›¡ï¸ PRESERVATION METHOD: Selective Alien Technology Backup
        âš¡ SPEED OPTIMIZED: Fast backup/restore cycles
        ğŸŒŒ UNIVERSE CONTINUITY: 100% data preservation
        ğŸ‘½ ALIEN FORCE: Maximum efficiency protocols

          It's Hero Time! ğŸ’¥
         EOF
        
        # Create temporal data core
        echo "ğŸ”¬ Compressing universe into temporal data core..."
        TIMESTAMP=$(date +%Y%m%d-%H%M%S)
        CORE_NAME="omnitrix-universe-$TIMESTAMP.tar.gz"
        
        cd /tmp
        sudo tar -czf "$BACKUP_NEXUS/$BACKUP_ARTIFACT" universe_preservation/ 2>/dev/null || {
          echo "âš ï¸ Standard compression failed, using alternative method..."
          sudo tar -cf "$BACKUP_NEXUS/$BACKUP_ARTIFACT" universe_preservation/
        }
        
        # Set proper permissions
        sudo chown runner:runner "$BACKUP_NEXUS/$BACKUP_ARTIFACT"
        
        # Validation and reporting
        if [[ -f "$BACKUP_NEXUS/$BACKUP_ARTIFACT" ]]; then
          CORE_SIZE=$(du -h "$BACKUP_NEXUS/$BACKUP_ARTIFACT" | cut -f1)
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "âœ… TEMPORAL DATA CORE CREATED SUCCESSFULLY! ğŸŒŒ"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "ğŸ’¾ Core Size: $CORE_SIZE"
          echo "âš¡ Compression: Alien technology optimized"
          echo "ğŸ”¬ Integrity: Verified and secured"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          
          # Show core contents preview
          echo "ğŸ“‹ Temporal Data Core Contents:"
          tar -tzf "$BACKUP_NEXUS/$BACKUP_ARTIFACT" | head -15
        else
          echo "âŒ CRITICAL: Temporal data core creation failed!"
          echo "ğŸ›¸ Universe preservation compromised!"
          exit 1
        fi
        
        # Cleanup preservation chamber
        sudo rm -rf "$PRESERVATION_CHAMBER"
        echo "ğŸ§¹ Preservation chamber cleaned and secured!"

    - name: "ğŸš€ GALACTIC ARTIFACT TRANSMISSION"
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: ${{ env.BACKUP_ARTIFACT }}
        path: ${{ env.BACKUP_NEXUS }}/${{ env.BACKUP_ARTIFACT }}
        retention-days: 7
        if-no-files-found: error

    - name: "â˜ï¸ GALVAN PRIME CLOUD SYNCHRONIZATION"
      if: always()  
      run: |
        set -euo pipefail
        
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        echo "â˜ï¸      GALVAN PRIME CLOUD SYNCHRONIZATION             ğŸŒŒ"
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        echo "ğŸ›¸ Uploading temporal data core to Galvan Prime..."
        echo "âš¡ Establishing quantum link to GitHub artifacts..."
        
        # Wait for artifact processing with exponential backoff
        echo "â° Waiting for GitHub artifact processing..."
        
        SYNC_SUCCESS=false
        for attempt in {1..8}; do
          wait_time=$((attempt * 10))  # 10, 20, 30... seconds
