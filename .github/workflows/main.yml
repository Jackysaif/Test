# ğŸ›¸ OMNITRIX VPS SESSION - BEN 10 ALIEN FORCE EDITION ğŸ‘½
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#                    ğŸ”‹ POWERED BY ALIEN TECHNOLOGY ğŸ”‹
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

name: "ğŸ›¸ OMNITRIX VPS - Ben 10 Alien Force Edition ğŸ‘½"

on:
  workflow_dispatch:
  schedule:
    - cron: '0 */6 * * *'

env:
  BACKUP_STORAGE: /mnt/omnitrix
  BACKUP_ARTIFACT: omnitrix-universe-core.tar.gz
  GALVAN_CLOUD: mega:omnitrix-vault
  HERO_SESSION_DURATION: 19800
  PLUMBER_NETWORK: Plumbers-HQ
  
jobs:
  omnitrix_session:
    name: "ğŸ›¸ OMNITRIX UNIVERSE SESSION ğŸ‘½"
    runs-on: ubuntu-22.04
    timeout-minutes: 350
    permissions:
      contents: read
      actions: write
    
    steps:
    - name: "ğŸ›¸ Scanning Universe Repository"
      uses: actions/checkout@v4
      
    - name: "ğŸ’¾ Initialize Omnitrix Storage Systems"
      run: |
        set -e
        
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        echo "ğŸ’¾         INITIALIZING OMNITRIX STORAGE              ğŸ›¸"
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        
        # Create /mnt storage structure
        sudo mkdir -p "$BACKUP_STORAGE"/{backups,temp,restore,operations}
        sudo chmod 777 "$BACKUP_STORAGE" -R
        
        # Mount tmpfs for high-speed operations (reduced size since no intermediate extraction)
        sudo mount -t tmpfs -o size=1G tmpfs "$BACKUP_STORAGE/operations"
        
        echo "âœ… Storage systems initialized!"
        echo "ğŸ“ Backup Storage: $BACKUP_STORAGE"
        echo "âš¡ Operations: tmpfs mounted for speed"
        
    - name: "âš¡ Deploy Alien Technology Suite"
      run: |
        set -e
        
        echo "âš¡ Deploying alien technology suite..."
        
        # Update system
        sudo apt-get update -qq
        
        # Install essential packages
        PACKAGES="curl wget jq tar gzip unzip openssh-server nano vim git net-tools"
        PACKAGES="$PACKAGES software-properties-common apt-transport-https ca-certificates"
        PACKAGES="$PACKAGES gnupg psmisc screen expect tmate mariadb-server mariadb-client"
        PACKAGES="$PACKAGES rsync htop iotop ncdu tree"
        
        sudo DEBIAN_FRONTEND=noninteractive apt-get install -y $PACKAGES
        
        # Install rclone
        if ! command -v rclone >/dev/null 2>&1; then
          curl -fsSL https://rclone.org/install.sh | sudo bash
        fi
        
        echo "âœ… Alien technology deployed!"

    - name: "â˜ï¸ Configure Galvan Prime Connection"
      run: |
        set -e
        
        echo "â˜ï¸ Configuring Galvan Prime connection..."
        
        if [[ -z "${{ secrets.RCLONE_CONFIG || '' }}" ]]; then
          echo "âŒ RCLONE_CONFIG secret missing!"
          exit 1
        fi
        
        # Setup rclone config
        mkdir -p ~/.config/rclone
        sudo mkdir -p /root/.config/rclone
        
        if echo "${{ secrets.RCLONE_CONFIG }}" | base64 -d >/dev/null 2>&1; then
          echo "${{ secrets.RCLONE_CONFIG }}" | base64 -d > ~/.config/rclone/rclone.conf
          echo "${{ secrets.RCLONE_CONFIG }}" | base64 -d | sudo tee /root/.config/rclone/rclone.conf >/dev/null
        else
          echo "${{ secrets.RCLONE_CONFIG }}" > ~/.config/rclone/rclone.conf
          echo "${{ secrets.RCLONE_CONFIG }}" | sudo tee /root/.config/rclone/rclone.conf >/dev/null
        fi
        
        chmod 600 ~/.config/rclone/rclone.conf
        sudo chmod 600 /root/.config/rclone/rclone.conf
        
        # Test connection
        if rclone lsd "$GALVAN_CLOUD" >/dev/null 2>&1; then
          echo "âœ… Galvan Prime connection established!"
        else
          echo "âš ï¸ Galvan Prime connection failed, continuing..."
        fi

    - name: "ğŸ” Scan for Temporal Data Cores"
      id: scan_cores
      run: |
        set -e
        
        echo "ğŸ” Scanning for temporal data cores..."
        
        RECOVERY_METHOD=""
        ARTIFACT_URL=""
        
        # Check for artifact link in MEGA
        if rclone cat "$GALVAN_CLOUD/artifact_link.txt" >/dev/null 2>&1; then
          ARTIFACT_URL=$(rclone cat "$GALVAN_CLOUD/artifact_link.txt")
          if [[ -n "$ARTIFACT_URL" ]]; then
            echo "âœ… Found artifact link in Galvan Prime!"
            RECOVERY_METHOD="artifact_link"
          fi
        fi
        
        # Check GitHub artifacts if no link found
        if [[ -z "$RECOVERY_METHOD" ]]; then
          echo "ğŸ” Scanning GitHub artifacts..."
          
          ARTIFACTS_RESPONSE=$(curl -s -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" \
            "https://api.github.com/repos/${{ github.repository }}/actions/workflows" 2>/dev/null || echo "")
          
          if [[ -n "$ARTIFACTS_RESPONSE" ]]; then
            WORKFLOW_ID=$(echo "$ARTIFACTS_RESPONSE" | jq -r '.workflows[] | select(.name | test("OMNITRIX"; "i")) | .id' | head -1)
            
            if [[ -n "$WORKFLOW_ID" && "$WORKFLOW_ID" != "null" ]]; then
              RUNS_RESPONSE=$(curl -s -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" \
                "https://api.github.com/repos/${{ github.repository }}/actions/workflows/$WORKFLOW_ID/runs?status=success&per_page=3" 2>/dev/null || echo "")
              
              if [[ -n "$RUNS_RESPONSE" ]]; then
                RECENT_RUN=$(echo "$RUNS_RESPONSE" | jq -r --argjson current "${{ github.run_id }}" \
                  '.workflow_runs[] | select(.id != $current) | .id' | head -1)
                
                if [[ -n "$RECENT_RUN" && "$RECENT_RUN" != "null" ]]; then
                  ARTIFACTS_DATA=$(curl -s -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" \
                    "https://api.github.com/repos/${{ github.repository }}/actions/runs/$RECENT_RUN/artifacts" 2>/dev/null || echo "")
                  
                  if [[ -n "$ARTIFACTS_DATA" ]]; then
                    ARTIFACT_ID=$(echo "$ARTIFACTS_DATA" | jq -r '.artifacts[] | select(.name | test("omnitrix"; "i")) | .id' | head -1)
                    
                    if [[ -n "$ARTIFACT_ID" && "$ARTIFACT_ID" != "null" ]]; then
                      ARTIFACT_URL="https://api.github.com/repos/${{ github.repository }}/actions/artifacts/$ARTIFACT_ID/zip"
                      echo "âœ… Found GitHub artifact backup!"
                      RECOVERY_METHOD="github_artifact"
                    fi
                  fi
                fi
              fi
            fi
          fi
        fi
        
        # Set outputs
        if [[ -n "$RECOVERY_METHOD" ]]; then
          echo "has_backup=true" >> $GITHUB_OUTPUT
          echo "method=$RECOVERY_METHOD" >> $GITHUB_OUTPUT
          echo "url=$ARTIFACT_URL" >> $GITHUB_OUTPUT
          echo "âœ… Temporal data core located!"
        else
          echo "has_backup=false" >> $GITHUB_OUTPUT
          echo "method=none" >> $GITHUB_OUTPUT
          echo "â„¹ï¸ No temporal data cores found - fresh universe mode"
        fi

    - name: "ğŸ“¥ Restore Temporal Data Core"
      if: steps.scan_cores.outputs.has_backup == 'true'
      run: |
        set -e
        
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        echo "ğŸ“¥           RESTORING TEMPORAL DATA CORE             ğŸŒŒ"
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        echo "ğŸ”‹ Method: ${{ steps.scan_cores.outputs.method }}"
        
        RESTORE_DIR="$BACKUP_STORAGE/restore"
        ARTIFACT_URL="${{ steps.scan_cores.outputs.url }}"
        
        # Download artifact
        echo "â¬‡ï¸ Downloading temporal data core..."
        cd "$RESTORE_DIR"
        
        for attempt in {1..3}; do
          if curl -L -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" \
               "$ARTIFACT_URL" -o universe_core.zip; then
            if [[ -s universe_core.zip ]]; then
              echo "âœ… Download successful ($(du -h universe_core.zip | cut -f1))"
              break
            fi
          fi
          echo "âš ï¸ Attempt $attempt failed, retrying..."
          sleep 5
        done
        
        # Extract archive
        echo "ğŸ“¦ Extracting universe core..."
        unzip -q universe_core.zip || {
          echo "âš ï¸ Unzip failed, trying python..."
          python3 -c "import zipfile; zipfile.ZipFile('universe_core.zip').extractall('.')"
        }
        
        # Find backup file
        BACKUP_FILE=$(find . -name "*.tar.gz" -type f | head -1)
        if [[ -z "$BACKUP_FILE" ]]; then
          echo "âŒ No backup file found in archive"
          exit 1
        fi
        
        echo "ğŸ“‹ Found backup: $BACKUP_FILE"
        
        # Direct extraction to final destinations
        echo "ğŸ”§ Directly extracting backup data to final destinations..."
        
        # Function to directly extract specific paths from tar
        extract_to_destination() {
          local tar_path="$1"
          local dest_path="$2"
          local desc="$3"
          
          echo "ğŸ“‚ Extracting $desc directly to $dest_path..."
          
          # Create destination directory
          sudo mkdir -p "$dest_path"
          
          # Check if path exists in tar and extract directly
          if tar -tzf "$BACKUP_FILE" 2>/dev/null | grep -q "^backup/$tar_path/" || \
             tar -tf "$BACKUP_FILE" 2>/dev/null | grep -q "^backup/$tar_path/"; then
            
            # Extract directly to destination, stripping backup/ prefix
            tar -xzf "$BACKUP_FILE" -C "$dest_path" --strip-components=2 \
                --wildcards "backup/$tar_path/*" 2>/dev/null || \
            tar -xf "$BACKUP_FILE" -C "$dest_path" --strip-components=2 \
                --wildcards "backup/$tar_path/*" 2>/dev/null || true
            
            echo "âœ… $desc extracted directly"
          else
            echo "â„¹ï¸ No $desc data found in backup"
          fi
        }
        
        # Extract system data directly to final locations
        extract_to_destination "home" "/home" "Hero Base"
        extract_to_destination "root" "/root" "Command Center"  
        extract_to_destination "tailscale" "/var/lib/tailscale" "Plumber Network"
        extract_to_destination "mysql" "/var/lib/mysql" "Database Fortress"
        extract_to_destination "www" "/var/www" "Web Arsenal"
        extract_to_destination "aapanel" "/www" "Control Panel"
        extract_to_destination "opt" "/opt" "Applications"
        
        # Extract configs directly to /etc
        echo "âš™ï¸ Extracting configurations directly to /etc..."
        if tar -tzf "$BACKUP_FILE" 2>/dev/null | grep -q "^backup/configs/" || \
           tar -tf "$BACKUP_FILE" 2>/dev/null | grep -q "^backup/configs/"; then
          
          tar -xzf "$BACKUP_FILE" -C /etc --strip-components=2 \
              --wildcards "backup/configs/*" 2>/dev/null || \
          tar -xf "$BACKUP_FILE" -C /etc --strip-components=2 \
              --wildcards "backup/configs/*" 2>/dev/null || true
          
          echo "âœ… Configurations extracted directly"
        fi
        
        # Fix permissions
        sudo chown -R mysql:mysql /var/lib/mysql 2>/dev/null || true
        sudo chown -R www-data:www-data /var/www 2>/dev/null || true
        sudo chmod 700 /root 2>/dev/null || true
        
        echo "âœ… Temporal data core restoration complete!"

    - name: "ğŸ‘¤ Configure Hero Account"
      run: |
        set -e
        
        echo "ğŸ‘¤ Configuring Hero Account (Ben Tennyson Protocol)..."
        
        if [[ -z "${{ secrets.USER_PASSWORD || '' }}" ]]; then
          echo "âŒ USER_PASSWORD secret missing!"
          exit 1
        fi
        
        # Create hero account
        if ! id jacky >/dev/null 2>&1; then
          sudo useradd -m -s /bin/bash -G sudo,root jacky
          echo "âœ… Hero account created!"
        fi
        
        # Set password and permissions
        echo "jacky:${{ secrets.USER_PASSWORD }}" | sudo chpasswd
        
        # Add to admin groups
        for group in sudo adm dialout cdrom audio dip video plugdev netdev; do
          sudo usermod -aG "$group" jacky 2>/dev/null || true
        done
        
        # Configure sudo access
        echo "jacky ALL=(ALL:ALL) NOPASSWD:ALL" | sudo tee /etc/sudoers.d/hero >/dev/null
        sudo chmod 440 /etc/sudoers.d/hero
        
        # Set hostname
        sudo hostnamectl set-hostname "$PLUMBER_NETWORK" 2>/dev/null || true
        
        echo "âœ… Hero account configured!"

    - name: "ğŸ›ï¸ Deploy Alien Control Panel"
      run: |
        set -e
        
        echo "ğŸ›ï¸ Deploying Alien Control Panel (aaPanel)..."
        
        if command -v bt >/dev/null 2>&1; then
          echo "âœ… Control panel already installed!"
        else
          echo "ğŸš€ Installing control panel..."
          cd /tmp
          
          if curl -fsSL "http://www.aapanel.com/script/install_6.0_en.sh" -o install.sh; then
            chmod +x install.sh
            timeout 600 bash -c 'echo -e "y\nyes\ny" | sudo bash install.sh' || true
            sleep 10
          fi
        fi
        
        # Configure credentials
        if command -v bt >/dev/null 2>&1; then
          sudo timeout 30 bt 6 <<< "Ben10" 2>/dev/null || true
          sudo timeout 30 bt 5 <<< "omnitrix" 2>/dev/null || true
          echo "âœ… Control panel configured (Ben10/omnitrix)"
        fi

    - name: "ğŸ—„ï¸ Initialize Database Fortress"
      run: |
        set -e
        
        echo "ğŸ—„ï¸ Initializing Database Fortress (MariaDB)..."
        
        # Start MariaDB
        sudo systemctl enable mariadb
        sudo systemctl start mariadb || {
          sudo mysql_install_db --user=mysql --basedir=/usr --datadir=/var/lib/mysql
          sudo systemctl start mariadb
        }
        
        sleep 3
        
        # Configure database
        if sudo systemctl is-active mariadb >/dev/null; then
          if [[ -n "${{ secrets.DB_ROOT_PASSWORD || '' }}" ]]; then
            sudo mysql -e "ALTER USER 'root'@'localhost' IDENTIFIED BY '${{ secrets.DB_ROOT_PASSWORD }}';" 2>/dev/null || \
            sudo mysqladmin -u root password '${{ secrets.DB_ROOT_PASSWORD }}' 2>/dev/null || true
          fi
          
          # Create databases
          sudo mysql -e "CREATE DATABASE IF NOT EXISTS omnitrix_data;" 2>/dev/null || true
          echo "âœ… Database fortress online!"
        fi

    - name: "ğŸ”— Establish Plumber Network"
      run: |
        set -e
        
        echo "ğŸ”— Establishing Plumber Network (Tailscale)..."
        
        if [[ -z "${{ secrets.TAILSCALE_AUTHKEY || '' }}" ]]; then
          echo "âŒ TAILSCALE_AUTHKEY missing!"
          exit 1
        fi
        
        # Install Tailscale
        if ! command -v tailscale >/dev/null 2>&1; then
          curl -fsSL https://tailscale.com/install.sh | sh
        fi
        
        # Start service
        sudo systemctl enable --now tailscaled
        sleep 3
        
        # Connect to network
        for attempt in {1..3}; do
          if sudo tailscale up --authkey="${{ secrets.TAILSCALE_AUTHKEY }}" \
               --hostname="$PLUMBER_NETWORK" --reset --accept-routes; then
            echo "âœ… Plumber network connected!"
            break
          fi
          sleep 10
        done
        
        # Start emergency access
        if command -v tmate >/dev/null 2>&1; then
          tmate -S /tmp/emergency.sock new-session -d 2>/dev/null || true
        fi

    - name: "âš¡ Activate Power Systems"
      run: |
        set -e
        
        echo "âš¡ Activating alien power systems..."
        
        # Start services
        sudo systemctl daemon-reload
        
        for service in ssh mariadb; do
          sudo systemctl enable "$service"
          sudo systemctl start "$service" || sudo systemctl restart "$service"
        done
        
        # Start aaPanel
        if command -v bt >/dev/null 2>&1; then
          sudo bt start 2>/dev/null || true
        fi
        
        echo "âœ… Power systems activated!"

    - name: "ğŸ›¸ Omnitrix Operational Session"
      run: |
        set -e
        
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        echo "ğŸ›¸           OMNITRIX OPERATIONAL SESSION              ğŸ‘½"
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        
        MISSION_START=$(date +%s)
        STATUS_INTERVAL=300
        CHECK_INTERVAL=15
        
        # Get network info
        PLUMBER_IP=$(sudo tailscale ip -4 2>/dev/null || echo "Acquiring...")
        EMERGENCY_SSH=$(tmate -S /tmp/emergency.sock display -p '#{tmate_ssh}' 2>/dev/null || echo "Initializing...")
        
        echo "ğŸŒ Plumber Network IP: $PLUMBER_IP"
        echo "ğŸ” Hero SSH: ssh jacky@$PLUMBER_IP"
        echo "ğŸš¨ Emergency SSH: $EMERGENCY_SSH"
        if command -v bt >/dev/null; then
          echo "ğŸ›ï¸ Control Panel: http://$PLUMBER_IP:7800 (Ben10/omnitrix)"
        fi
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        
        LAST_STATUS=0
        
        # Main operational loop
        while true; do
          CURRENT_TIME=$(date +%s)
          ELAPSED=$((CURRENT_TIME - MISSION_START))
          
          # Check for completion
          if [ $ELAPSED -gt $HERO_SESSION_DURATION ]; then
            echo "â° Mission duration completed!"
            break
          fi
          
          # Check for emergency shutdown
          if [ -f /tmp/stop ]; then
            echo "ğŸš¨ Emergency shutdown detected!"
            rm -f /tmp/stop
            break
          fi
          
          # Status updates
          if [ $((CURRENT_TIME - LAST_STATUS)) -gt $STATUS_INTERVAL ]; then
            REMAINING=$((HERO_SESSION_DURATION - ELAPSED))
            HOURS=$((REMAINING / 3600))
            MINUTES=$(((REMAINING % 3600) / 60))
            
            echo "ğŸ›¸ STATUS - $(date) | Time: ${HOURS}h ${MINUTES}m | Mode: Jetray"
            LAST_STATUS=$CURRENT_TIME
          fi
          
          sleep $CHECK_INTERVAL
        done
        
        echo "ğŸ¬ Omnitrix session complete!"

    - name: "ğŸ’¾ Universe Preservation Protocol"
      if: always()
      run: |
        set -e
        
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        echo "ğŸ’¾      UNIVERSE PRESERVATION PROTOCOL               ğŸŒŒ"
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        
        # Stop services for consistent backup
        echo "ğŸ›‘ Stopping services for backup..."
        for service in bt mariadb nginx apache2; do
          sudo systemctl stop "$service" 2>/dev/null || true
        done
        sleep 3
        
        # Create backup in operations storage
        BACKUP_DIR="$BACKUP_STORAGE/operations/backup"
        mkdir -p "$BACKUP_DIR"
        
        echo "ğŸ“¦ Collecting universe data..."
        
        # Backup function
        backup_data() {
          local src="$1"
          local dest="$2"
          local desc="$3"
          
          if [[ -d "$src" ]] && [[ -n "$(sudo ls -A "$src" 2>/dev/null)" ]]; then
            echo "ğŸ“‚ Backing up $desc..."
            sudo mkdir -p "$BACKUP_DIR/$dest"
            sudo cp -rf "$src"/* "$BACKUP_DIR/$dest"/ 2>/dev/null || \
            sudo rsync -av "$src"/ "$BACKUP_DIR/$dest"/ 2>/dev/null || true
            echo "âœ… $desc backed up"
          fi
        }
        
        # Backup all data
        backup_data "/home" "home" "Hero Base"
        backup_data "/root" "root" "Command Center"
        backup_data "/var/lib/tailscale" "tailscale" "Plumber Network"
        backup_data "/var/lib/mysql" "mysql" "Database Fortress"
        backup_data "/var/www" "www" "Web Arsenal"
        backup_data "/www" "aapanel" "Control Panel"
        backup_data "/opt" "opt" "Applications"
        
        # Backup configs
        echo "âš™ï¸ Backing up configurations..."
        sudo mkdir -p "$BACKUP_DIR/configs"
        for config in hostname hosts ssh sudoers.d; do
          if [[ -e "/etc/$config" ]]; then
            sudo cp -rf "/etc/$config" "$BACKUP_DIR/configs/" 2>/dev/null || true
          fi
        done
        
        # Create manifest
        cat > "$BACKUP_DIR/manifest.txt" << EOF
        ğŸ›¸ OMNITRIX UNIVERSE PRESERVATION CORE
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        ğŸŒŸ Hero: Ben Tennyson | Edition: Alien Force
        â° Backup Date: $(date)
        ğŸ†” Session ID: ${{ github.run_id }}
        ğŸŒ Universe: $PLUMBER_NETWORK
        ğŸ‘½ Mode: Jetray (High-Speed Operations)

        ğŸ“¦ PRESERVED DATA:
        âœ… Hero Base (/home) - User data and configurations
        âœ… Command Center (/root) - Root environment
        âœ… Plumber Network (/var/lib/tailscale) - VPN state
        âœ… Database Fortress (/var/lib/mysql) - All databases
        âœ… Web Arsenal (/var/www) - Web server data
        âœ… Control Panel (/www) - aaPanel configuration
        âœ… Applications (/opt) - Custom applications
        âœ… System Configs (/etc) - Critical configurations

        ğŸ›¡ï¸ METHOD: Complete Universe Backup
        âš¡ STORAGE: GitHub Artifacts + MEGA Link
        ğŸŒŒ CONTINUITY: Full state preservation

        It's Hero Time! ğŸ’¥
        EOF
        
        # Create compressed backup
        echo "ğŸ”¬ Creating temporal data core..."
        cd "$BACKUP_STORAGE/operations"
        tar -czf "$BACKUP_STORAGE/backups/$BACKUP_ARTIFACT" backup/ 2>/dev/null || \
        tar -cf "$BACKUP_STORAGE/backups/$BACKUP_ARTIFACT" backup/
        
        # Verify backup
        if [[ -f "$BACKUP_STORAGE/backups/$BACKUP_ARTIFACT" ]]; then
          BACKUP_SIZE=$(du -h "$BACKUP_STORAGE/backups/$BACKUP_ARTIFACT" | cut -f1)
          echo "âœ… Temporal data core created! Size: $BACKUP_SIZE"
        else
          echo "âŒ Backup creation failed!"
          exit 1
        fi

    - name: "ğŸš€ Upload to GitHub Artifacts"
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: ${{ env.BACKUP_ARTIFACT }}
        path: ${{ env.BACKUP_STORAGE }}/backups/${{ env.BACKUP_ARTIFACT }}
        retention-days: 7
        if-no-files-found: error

    - name: "â˜ï¸ Sync Artifact Link to Galvan Prime"
      if: always()
      run: |
        set -e
        
        echo "â˜ï¸ Syncing artifact link to Galvan Prime..."
        
        # Wait for artifact processing
        sleep 30
        
        for attempt in {1..5}; do
          echo "â³ Sync attempt $attempt/5..."
          
          # Get artifact info
          ARTIFACTS_DATA=$(curl -s -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" \
            "https://api.github.com/repos/${{ github.repository }}/actions/runs/${{ github.run_id }}/artifacts" 2>/dev/null || echo "")
          
          if [[ -n "$ARTIFACTS_DATA" ]]; then
            ARTIFACT_ID=$(echo "$ARTIFACTS_DATA" | jq -r --arg name "$BACKUP_ARTIFACT" \
              '.artifacts[] | select(.name == $name) | .id' | head -1)
            
            if [[ -n "$ARTIFACT_ID" && "$ARTIFACT_ID" != "null" ]]; then
              ARTIFACT_LINK="https://api.github.com/repos/${{ github.repository }}/actions/artifacts/$ARTIFACT_ID/zip"
              
              # Store link in MEGA
              if echo "$ARTIFACT_LINK" | rclone rcat "$GALVAN_CLOUD/artifact_link.txt" 2>/dev/null; then
                echo "âœ… Artifact link synced to Galvan Prime!"
                echo "ğŸ”— Link: $ARTIFACT_LINK"
                break
              fi
            fi
          fi
          
          sleep 15
        done

    - name: "ğŸ“Š Mission Completion Report"
      if: always()
      run: |
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        echo "ğŸ›¸           MISSION COMPLETION REPORT                 ğŸ‘½"
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        echo "ğŸŒŸ Hero: Ben Tennyson | Edition: Alien Force"
        echo "âš¡ Status: ${{ job.status }}"
        echo "ğŸ†” Mission ID: ${{ github.run_id }}"
        echo "â° Completion: $(date)"
        echo "ğŸ• Runtime: $((SECONDS / 60)) minutes"
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        
        echo "ğŸ”‹ SYSTEM STATUS:"
        echo "   ğŸ›ï¸ Control Panel: $(command -v bt >/dev/null && echo 'ACTIVE' || echo 'INACTIVE')"
        echo "   ğŸ—„ï¸ Database: $(systemctl is-active mariadb 2>/dev/null || echo 'UNKNOWN')"
        echo "   ğŸ”— Network: $(systemctl is-active tailscaled 2>/dev/null || echo 'UNKNOWN')"
        echo "   ğŸ“¡ Emergency: $(pgrep tmate >/dev/null && echo 'ACTIVE' || echo 'STANDBY')"
        
        echo ""
        echo "ğŸ‘¤ HERO ACCESS:"
        echo "   ğŸ¦¸â€â™‚ï¸ Account: jacky (full privileges)"
        echo "   ğŸ” Authentication: Configured"
        echo "   âš¡ Powers: Complete system control"
        
        echo ""
        echo "ğŸ’¾ BACKUP STATUS:"
        echo "   ğŸ“¦ Method: GitHub Artifacts + MEGA Link"
        echo "   âš¡ Speed: Optimized with /mnt tmpfs"
        echo "   ğŸŒŒ Coverage: Complete universe preservation"
        echo "   ğŸ”— Link Storage: Galvan Prime (MEGA)"
        
        echo ""
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        echo "ğŸ‰ MISSION SUCCESS! UNIVERSE PROTECTED! ğŸ›¡ï¸"
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        echo "ğŸ’¥ Ben 10: 'It's Hero Time - Mission Complete!'"
        echo "ğŸ›¸ Omnitrix ready for next transformation!"
        echo "ğŸ‘½ All alien technology preserved!"
        echo "ğŸŒŒ Universe continuity maintained!"
        echo ""
        echo "ğŸ”‹ OMNITRIX STATUS: STANDBY"
        echo "â­ Ready for next adventure!"
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
