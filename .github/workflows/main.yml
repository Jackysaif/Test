      # 5. Restore backup if exists
      - name: Restore backup if exists
        run: |
          # Download each backup file individually
          LATEST_RELEASE=$(curl -s -H "Authorization: Bearer ${{ secrets.GITHUB_TOKEN }}" \
            "https://api.github.com/repos/${{ github.repository }}/releases/latest" | \
            grep '"tag_name":' | sed -E 's/.*"([^"]+)".*/\1/')
          
          if [ -n "$LATEST_RELEASE" ] && [ "$LATEST_RELEASE" != "null" ]; then
            echo "üì¶ Downloading backup files from release: $LATEST_RELEASE"
            
            # Download each file individually
            for file in jacky-home-full.tar.gz services-backup.tar.gz system-config.tar.gz installed-packages.list; do
              echo "Downloading $file..."
              ASSET_ID=$(curl -s -H "Authorization: Bearer ${{ secrets.GITHUB_TOKEN }}" \
                "https://api.github.com/repos/${{ github.repository }}/releases/tags/$LATEST_RELEASE" | \
                grep -A 1 "\"name\": \"$file\"" | grep '"id":' | cut -d':' -f2 | tr -d ' ,')
              
              if [ -n "$ASSET_ID" ]; then
                curl -L -H "Authorization: Bearer ${{ secrets.GITHUB_TOKEN }}" \
                  -H "Accept: application/octet-stream" \
                  -o "restore/$file" \
                  "https://api.github.com/repos/${{ github.repository }}/releases/assets/$ASSET_ID" \
                  || echo "‚ö†Ô∏è Could not download $file"
              else
                echo "‚ö†Ô∏è $file not found in release"
              fi
            done
            
            echo "‚úÖ Backup files downloaded successfully"
          else
            echo "‚ö†Ô∏è No releases found, starting fresh"
          fi
          
          # Restore from individual files
          echo "üîÑ Restoring backup..."
          
          # Restore jacky user data (all files including hidden)
          if [ -f "restore/jacky-home-full.tar.gz" ] && file restore/jacky-home-full.tar.gz | grep -q "gzip compressed data"; then
            echo "üì¶ Restoring jacky user data (all files)..."
            sudo tar -xzf restore/jacky-home-full.tar.gz -C /
          else
            echo "‚ö†Ô∏è No jacky user data found to restore"
          fi
          
          # Restore services if they were installed
          if [ -f "restore/services-backup.tar.gz" ] && file restore/services-backup.tar.gz | grep -q "gzip compressed data"; then
            echo "üîÑ Restoring system services (Apache, MySQL, etc)..."
            sudo tar -xzf restore/services-backup.tar.gz -C /
          else
            echo "‚ö†Ô∏è No system services found to restore"
          fi
          
          # Restore system configurations
          if [ -f "restore/system-config.tar.gz" ] && file restore/system-config.tar.gz | grep -q "gzip compressed data"; then
            echo "üîÑ Restoring system configurations..."
            sudo tar -xzf restore/system-config.tar.gz -C /
          else
            echo "‚ö†Ô∏è No system configurations found to restore"
          fi
          
          # Reinstall previously installed packages
          if [ -f "restore/installed-packages.list" ]; then
            echo "üì¶ Reinstalling previous packages..."
            sudo apt-get update
            sudo dpkg --set-selections < restore/installed-packages.list
            sudo apt-get upgrade -y
            sudo apt-get dselect-upgrade -y
          else
            echo "‚ö†Ô∏è No installed packages list found to restore"
          fi
          
          echo "‚úÖ Restoration completed"
